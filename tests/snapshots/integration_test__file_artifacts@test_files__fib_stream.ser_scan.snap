---
source: tests/integration_test.rs
expression: result
---
<Type         "type"        [1]>
<Identifier   "stream"      [1]>
<Interface    "interface"   [1]>
<LeftBrace    "{"           [1]>
<Identifier   "car"         [2]>
<Colon        ":"           [2]>
<Fun          "fn"          [2]>
<LeftParen    "("           [2]>
<RightParen   ")"           [2]>
<RightArrow   "->"          [2]>
<SimpleType   "int"         [2]>
<Comma        ","           [2]>
<Identifier   "cdr"         [3]>
<Colon        ":"           [3]>
<Fun          "fn"          [3]>
<LeftParen    "("           [3]>
<RightParen   ")"           [3]>
<RightArrow   "->"          [3]>
<Impl         "impl"        [3]>
<Identifier   "stream"      [3]>
<Comma        ","           [3]>
<RightBrace   "}"           [4]>
<Semicolon    ";"           [4]>
<Fun          "fn"          [6]>
<Identifier   "next"        [6]>
<LeftParen    "("           [6]>
<Identifier   "s"           [6]>
<Colon        ":"           [6]>
<Star         "*"           [6]>
<Impl         "impl"        [6]>
<Identifier   "stream"      [6]>
<RightParen   ")"           [6]>
<RightArrow   "->"          [6]>
<SimpleType   "int"         [6]>
<LeftBrace    "{"           [6]>
<Var          "let"         [7]>
<Identifier   "n"           [7]>
<Equal        "="           [7]>
<Identifier   "s"           [7]>
<RightArrow   "->"          [7]>
<Identifier   "car"         [7]>
<LeftParen    "("           [7]>
<RightParen   ")"           [7]>
<Semicolon    ";"           [7]>
<Star         "*"           [8]>
<Identifier   "s"           [8]>
<Equal        "="           [8]>
<Identifier   "s"           [8]>
<RightArrow   "->"          [8]>
<Identifier   "cdr"         [8]>
<LeftParen    "("           [8]>
<RightParen   ")"           [8]>
<Semicolon    ";"           [8]>
<Return       "return"      [9]>
<Identifier   "n"           [9]>
<Semicolon    ";"           [9]>
<RightBrace   "}"           [10]>
<Type         "type"        [12]>
<Identifier   "const_stream" [12]>
<Struct       "struct"      [12]>
<LeftBrace    "{"           [12]>
<Identifier   "n"           [13]>
<Colon        ":"           [13]>
<SimpleType   "int"         [13]>
<Comma        ","           [13]>
<RightBrace   "}"           [14]>
<Implements   "implements"  [14]>
<Identifier   "stream"      [14]>
<Semicolon    ";"           [14]>
<Fun          "fun"         [16]>
<LeftParen    "("           [16]>
<Identifier   "self"        [16]>
<Colon        ":"           [16]>
<Star         "*"           [16]>
<Struct       "struct"      [16]>
<Identifier   "const_stream" [16]>
<RightParen   ")"           [16]>
<Identifier   "car"         [16]>
<LeftParen    "("           [16]>
<RightParen   ")"           [16]>
<RightArrow   "->"          [16]>
<SimpleType   "int"         [16]>
<LeftBrace    "{"           [16]>
<Return       "return"      [17]>
<Identifier   "self"        [17]>
<RightArrow   "->"          [17]>
<Identifier   "n"           [17]>
<Semicolon    ";"           [17]>
<RightBrace   "}"           [18]>
<Fun          "fun"         [20]>
<LeftParen    "("           [20]>
<Identifier   "self"        [20]>
<Colon        ":"           [20]>
<Star         "*"           [20]>
<Struct       "struct"      [20]>
<Identifier   "const_stream" [20]>
<RightParen   ")"           [20]>
<Identifier   "cdr"         [20]>
<LeftParen    "("           [20]>
<RightParen   ")"           [20]>
<RightArrow   "->"          [20]>
<Impl         "impl"        [20]>
<Identifier   "stream"      [20]>
<LeftBrace    "{"           [20]>
<Return       "return"      [21]>
<Identifier   "const_stream_impl_stream" [21]>
<LeftParen    "("           [21]>
<Identifier   "self"        [21]>
<RightParen   ")"           [21]>
<Semicolon    ";"           [21]>
<RightBrace   "}"           [22]>
<Type         "type"        [24]>
<Identifier   "nat_stream"  [24]>
<Struct       "struct"      [24]>
<LeftBrace    "{"           [24]>
<Identifier   "i"           [25]>
<Colon        ":"           [25]>
<SimpleType   "int"         [25]>
<Comma        ","           [25]>
<RightBrace   "}"           [26]>
<Implements   "implements"  [26]>
<Identifier   "stream"      [26]>
<Semicolon    ";"           [26]>
<Fun          "fun"         [28]>
<LeftParen    "("           [28]>
<Identifier   "self"        [28]>
<Colon        ":"           [28]>
<Star         "*"           [28]>
<Struct       "struct"      [28]>
<Identifier   "nat_stream"  [28]>
<RightParen   ")"           [28]>
<Identifier   "car"         [28]>
<LeftParen    "("           [28]>
<RightParen   ")"           [28]>
<RightArrow   "->"          [28]>
<SimpleType   "int"         [28]>
<LeftBrace    "{"           [28]>
<Return       "return"      [29]>
<Identifier   "self"        [29]>
<RightArrow   "->"          [29]>
<Identifier   "i"           [29]>
<Semicolon    ";"           [29]>
<RightBrace   "}"           [30]>
<Fun          "fun"         [32]>
<LeftParen    "("           [32]>
<Identifier   "self"        [32]>
<Colon        ":"           [32]>
<Star         "*"           [32]>
<Struct       "struct"      [32]>
<Identifier   "nat_stream"  [32]>
<RightParen   ")"           [32]>
<Identifier   "cdr"         [32]>
<LeftParen    "("           [32]>
<RightParen   ")"           [32]>
<RightArrow   "->"          [32]>
<Impl         "impl"        [32]>
<Identifier   "stream"      [32]>
<LeftBrace    "{"           [32]>
<Var          "let"         [33]>
<Identifier   "i"           [33]>
<Equal        "="           [33]>
<Identifier   "self"        [33]>
<RightArrow   "->"          [33]>
<Identifier   "i"           [33]>
<Semicolon    ";"           [33]>
<Var          "let"         [34]>
<Identifier   "s"           [34]>
<Colon        ":"           [34]>
<Star         "*"           [34]>
<Struct       "struct"      [34]>
<Identifier   "nat_stream"  [34]>
<Equal        "="           [34]>
<Identifier   "malloc"      [34]>
<LeftParen    "("           [34]>
<Sizeof       "sizeof"      [34]>
<LeftParen    "("           [34]>
<Struct       "struct"      [34]>
<Identifier   "nat_stream"  [34]>
<RightParen   ")"           [34]>
<RightParen   ")"           [34]>
<Semicolon    ";"           [34]>
<Star         "*"           [35]>
<Identifier   "s"           [35]>
<Equal        "="           [35]>
<Struct       "struct"      [35]>
<Identifier   "nat_stream"  [35]>
<LeftBrace    "{"           [35]>
<Identifier   "i"           [35]>
<Colon        ":"           [35]>
<Identifier   "i"           [35]>
<Plus         "+"           [35]>
<Number       "1"           [35]>
<RightBrace   "}"           [35]>
<Semicolon    ";"           [35]>
<Return       "return"      [36]>
<Identifier   "nat_stream_impl_stream" [36]>
<LeftParen    "("           [36]>
<Identifier   "s"           [36]>
<RightParen   ")"           [36]>
<Semicolon    ";"           [36]>
<RightBrace   "}"           [37]>
<Type         "type"        [39]>
<Identifier   "stream_cons" [39]>
<Struct       "struct"      [39]>
<LeftBrace    "{"           [39]>
<Identifier   "car"         [40]>
<Colon        ":"           [40]>
<SimpleType   "int"         [40]>
<Comma        ","           [40]>
<Identifier   "cdr"         [41]>
<Colon        ":"           [41]>
<Impl         "impl"        [41]>
<Identifier   "stream"      [41]>
<Comma        ","           [41]>
<RightBrace   "}"           [42]>
<Implements   "implements"  [42]>
<Identifier   "stream"      [42]>
<Semicolon    ";"           [42]>
<Fun          "fun"         [44]>
<LeftParen    "("           [44]>
<Identifier   "self"        [44]>
<Colon        ":"           [44]>
<Star         "*"           [44]>
<Struct       "struct"      [44]>
<Identifier   "stream_cons" [44]>
<RightParen   ")"           [44]>
<Identifier   "car"         [44]>
<LeftParen    "("           [44]>
<RightParen   ")"           [44]>
<RightArrow   "->"          [44]>
<SimpleType   "int"         [44]>
<LeftBrace    "{"           [44]>
<Return       "return"      [45]>
<Identifier   "self"        [45]>
<RightArrow   "->"          [45]>
<Identifier   "car"         [45]>
<Semicolon    ";"           [45]>
<RightBrace   "}"           [46]>
<Fun          "fun"         [48]>
<LeftParen    "("           [48]>
<Identifier   "self"        [48]>
<Colon        ":"           [48]>
<Star         "*"           [48]>
<Struct       "struct"      [48]>
<Identifier   "stream_cons" [48]>
<RightParen   ")"           [48]>
<Identifier   "cdr"         [48]>
<LeftParen    "("           [48]>
<RightParen   ")"           [48]>
<RightArrow   "->"          [48]>
<Impl         "impl"        [48]>
<Identifier   "stream"      [48]>
<LeftBrace    "{"           [48]>
<Return       "return"      [49]>
<Identifier   "self"        [49]>
<RightArrow   "->"          [49]>
<Identifier   "cdr"         [49]>
<Semicolon    ";"           [49]>
<RightBrace   "}"           [50]>
<Type         "type"        [52]>
<Identifier   "stream_add"  [52]>
<Struct       "struct"      [52]>
<LeftBrace    "{"           [52]>
<Identifier   "s1"          [53]>
<Colon        ":"           [53]>
<Impl         "impl"        [53]>
<Identifier   "stream"      [53]>
<Comma        ","           [53]>
<Identifier   "s2"          [54]>
<Colon        ":"           [54]>
<Impl         "impl"        [54]>
<Identifier   "stream"      [54]>
<Comma        ","           [54]>
<Identifier   "next"        [55]>
<Colon        ":"           [55]>
<Star         "*"           [55]>
<Struct       "struct"      [55]>
<Identifier   "stream_add"  [55]>
<Comma        ","           [55]>
<RightBrace   "}"           [56]>
<Implements   "implements"  [56]>
<Identifier   "stream"      [56]>
<Semicolon    ";"           [56]>
<Fun          "fn"          [58]>
<LeftParen    "("           [58]>
<Identifier   "self"        [58]>
<Colon        ":"           [58]>
<Star         "*"           [58]>
<Struct       "struct"      [58]>
<Identifier   "stream_add"  [58]>
<RightParen   ")"           [58]>
<Identifier   "destroy"     [58]>
<LeftParen    "("           [58]>
<RightParen   ")"           [58]>
<LeftBrace    "{"           [58]>
<If           "if"          [59]>
<LeftParen    "("           [59]>
<Identifier   "self"        [59]>
<RightArrow   "->"          [59]>
<Identifier   "next"        [59]>
<BangEqual    "!="          [59]>
<Cast         "cast"        [59]>
<LeftParen    "("           [59]>
<Number       "0"           [59]>
<RightParen   ")"           [59]>
<RightParen   ")"           [59]>
<LeftBrace    "{"           [59]>
<Identifier   "self"        [60]>
<RightArrow   "->"          [60]>
<Identifier   "next"        [60]>
<RightArrow   "->"          [60]>
<Identifier   "destroy"     [60]>
<LeftParen    "("           [60]>
<RightParen   ")"           [60]>
<Semicolon    ";"           [60]>
<Identifier   "free"        [61]>
<LeftParen    "("           [61]>
<Identifier   "self"        [61]>
<RightArrow   "->"          [61]>
<Identifier   "next"        [61]>
<RightParen   ")"           [61]>
<Semicolon    ";"           [61]>
<RightBrace   "}"           [62]>
<RightBrace   "}"           [63]>
<Fun          "fun"         [65]>
<LeftParen    "("           [65]>
<Identifier   "self"        [65]>
<Colon        ":"           [65]>
<Star         "*"           [65]>
<Struct       "struct"      [65]>
<Identifier   "stream_add"  [65]>
<RightParen   ")"           [65]>
<Identifier   "car"         [65]>
<LeftParen    "("           [65]>
<RightParen   ")"           [65]>
<RightArrow   "->"          [65]>
<SimpleType   "int"         [65]>
<LeftBrace    "{"           [65]>
<Return       "return"      [66]>
<Identifier   "self"        [66]>
<RightArrow   "->"          [66]>
<Identifier   "s1"          [66]>
<Dot          "."           [66]>
<Identifier   "car"         [66]>
<LeftParen    "("           [66]>
<RightParen   ")"           [66]>
<Plus         "+"           [66]>
<Identifier   "self"        [66]>
<RightArrow   "->"          [66]>
<Identifier   "s2"          [66]>
<Dot          "."           [66]>
<Identifier   "car"         [66]>
<LeftParen    "("           [66]>
<RightParen   ")"           [66]>
<Semicolon    ";"           [66]>
<RightBrace   "}"           [67]>
<Fun          "fun"         [69]>
<LeftParen    "("           [69]>
<Identifier   "self"        [69]>
<Colon        ":"           [69]>
<Star         "*"           [69]>
<Struct       "struct"      [69]>
<Identifier   "stream_add"  [69]>
<RightParen   ")"           [69]>
<Identifier   "cdr"         [69]>
<LeftParen    "("           [69]>
<RightParen   ")"           [69]>
<RightArrow   "->"          [69]>
<Impl         "impl"        [69]>
<Identifier   "stream"      [69]>
<LeftBrace    "{"           [69]>
<Var          "let"         [70]>
<Identifier   "s1"          [70]>
<Equal        "="           [70]>
<Identifier   "self"        [70]>
<RightArrow   "->"          [70]>
<Identifier   "s1"          [70]>
<Dot          "."           [70]>
<Identifier   "cdr"         [70]>
<LeftParen    "("           [70]>
<RightParen   ")"           [70]>
<Semicolon    ";"           [70]>
<Var          "let"         [71]>
<Identifier   "s2"          [71]>
<Equal        "="           [71]>
<Identifier   "self"        [71]>
<RightArrow   "->"          [71]>
<Identifier   "s2"          [71]>
<Dot          "."           [71]>
<Identifier   "cdr"         [71]>
<LeftParen    "("           [71]>
<RightParen   ")"           [71]>
<Semicolon    ";"           [71]>
<Var          "let"         [73]>
<Identifier   "add"         [73]>
<Colon        ":"           [73]>
<Star         "*"           [73]>
<Struct       "struct"      [73]>
<Identifier   "stream_add"  [73]>
<Equal        "="           [73]>
<Identifier   "malloc"      [73]>
<LeftParen    "("           [73]>
<Sizeof       "sizeof"      [73]>
<LeftParen    "("           [73]>
<Struct       "struct"      [73]>
<Identifier   "stream_add"  [73]>
<RightParen   ")"           [73]>
<RightParen   ")"           [73]>
<Semicolon    ";"           [73]>
<Star         "*"           [74]>
<Identifier   "add"         [74]>
<Equal        "="           [74]>
<Struct       "struct"      [74]>
<Identifier   "stream_add"  [74]>
<LeftBrace    "{"           [74]>
<Identifier   "s1"          [74]>
<Colon        ":"           [74]>
<Identifier   "s1"          [74]>
<Comma        ","           [74]>
<Identifier   "s2"          [74]>
<Colon        ":"           [74]>
<Identifier   "s2"          [74]>
<Comma        ","           [74]>
<Identifier   "next"        [74]>
<Colon        ":"           [74]>
<Number       "0"           [74]>
<RightBrace   "}"           [74]>
<Semicolon    ";"           [74]>
<Identifier   "self"        [75]>
<RightArrow   "->"          [75]>
<Identifier   "next"        [75]>
<Equal        "="           [75]>
<Identifier   "add"         [75]>
<Semicolon    ";"           [75]>
<Return       "return"      [77]>
<Identifier   "stream_add_impl_stream" [77]>
<LeftParen    "("           [77]>
<Identifier   "add"         [77]>
<RightParen   ")"           [77]>
<Semicolon    ";"           [77]>
<RightBrace   "}"           [78]>
<Fun          "fn"          [80]>
<Identifier   "cons"        [80]>
<LeftParen    "("           [80]>
<Identifier   "n"           [80]>
<Colon        ":"           [80]>
<SimpleType   "int"         [80]>
<Comma        ","           [80]>
<Identifier   "s"           [80]>
<Colon        ":"           [80]>
<Impl         "impl"        [80]>
<Identifier   "stream"      [80]>
<RightParen   ")"           [80]>
<RightArrow   "->"          [80]>
<Struct       "struct"      [80]>
<Identifier   "stream_cons" [80]>
<LeftBrace    "{"           [80]>
<Return       "return"      [81]>
<Struct       "struct"      [81]>
<Identifier   "stream_cons" [81]>
<LeftBrace    "{"           [81]>
<Identifier   "car"         [81]>
<Colon        ":"           [81]>
<Identifier   "n"           [81]>
<Comma        ","           [81]>
<Identifier   "cdr"         [81]>
<Colon        ":"           [81]>
<Identifier   "s"           [81]>
<RightBrace   "}"           [81]>
<Semicolon    ";"           [81]>
<RightBrace   "}"           [82]>
<Fun          "fn"          [84]>
<Identifier   "add"         [84]>
<LeftParen    "("           [84]>
<Identifier   "s1"          [84]>
<Colon        ":"           [84]>
<Impl         "impl"        [84]>
<Identifier   "stream"      [84]>
<Comma        ","           [84]>
<Identifier   "s2"          [84]>
<Colon        ":"           [84]>
<Impl         "impl"        [84]>
<Identifier   "stream"      [84]>
<Comma        ","           [84]>
<Identifier   "next"        [84]>
<Colon        ":"           [84]>
<Star         "*"           [84]>
<Struct       "struct"      [84]>
<Identifier   "stream_add"  [84]>
<RightParen   ")"           [84]>
<RightArrow   "->"          [84]>
<Struct       "struct"      [84]>
<Identifier   "stream_add"  [84]>
<LeftBrace    "{"           [84]>
<Return       "return"      [85]>
<Struct       "struct"      [85]>
<Identifier   "stream_add"  [85]>
<LeftBrace    "{"           [85]>
<Identifier   "s1"          [85]>
<Colon        ":"           [85]>
<Identifier   "s1"          [85]>
<Comma        ","           [85]>
<Identifier   "s2"          [85]>
<Colon        ":"           [85]>
<Identifier   "s2"          [85]>
<Comma        ","           [85]>
<Identifier   "next"        [85]>
<Colon        ":"           [85]>
<Identifier   "next"        [85]>
<RightBrace   "}"           [85]>
<Semicolon    ";"           [85]>
<RightBrace   "}"           [86]>
<Fun          "fn"          [88]>
<Identifier   "main"        [88]>
<LeftParen    "("           [88]>
<RightParen   ")"           [88]>
<RightArrow   "->"          [88]>
<SimpleType   "int"         [88]>
<LeftBrace    "{"           [88]>
<Var          "let"         [90]>
<Identifier   "fibs"        [90]>
<Semicolon    ";"           [90]>
<Var          "let"         [91]>
<Identifier   "fibs_cdr"    [91]>
<Semicolon    ";"           [91]>
<Var          "let"         [93]>
<Identifier   "add"         [93]>
<Equal        "="           [93]>
<Identifier   "add"         [93]>
<LeftParen    "("           [93]>
<Identifier   "impl_stream" [93]>
<LeftParen    "("           [93]>
<Amp          "&"           [93]>
<Identifier   "fibs"        [93]>
<RightParen   ")"           [93]>
<Comma        ","           [93]>
<Identifier   "impl_stream" [93]>
<LeftParen    "("           [93]>
<Amp          "&"           [93]>
<Identifier   "fibs_cdr"    [93]>
<RightParen   ")"           [93]>
<Comma        ","           [93]>
<Number       "0"           [93]>
<RightParen   ")"           [93]>
<Semicolon    ";"           [93]>
<Var          "let"         [94]>
<Identifier   "add0"        [94]>
<Equal        "="           [94]>
<Identifier   "add"         [94]>
<Semicolon    ";"           [94]>
<Identifier   "fibs_cdr"    [95]>
<Equal        "="           [95]>
<Identifier   "cons"        [95]>
<LeftParen    "("           [95]>
<Number       "1"           [95]>
<Comma        ","           [95]>
<Identifier   "impl_stream" [95]>
<LeftParen    "("           [95]>
<Amp          "&"           [95]>
<Identifier   "add"         [95]>
<RightParen   ")"           [95]>
<RightParen   ")"           [95]>
<Semicolon    ";"           [95]>
<Identifier   "fibs"        [96]>
<Equal        "="           [96]>
<Identifier   "cons"        [96]>
<LeftParen    "("           [96]>
<Number       "0"           [96]>
<Comma        ","           [96]>
<Identifier   "impl_stream" [96]>
<LeftParen    "("           [96]>
<Amp          "&"           [96]>
<Identifier   "fibs_cdr"    [96]>
<RightParen   ")"           [96]>
<RightParen   ")"           [96]>
<Semicolon    ";"           [96]>
<Var          "let"         [98]>
<Identifier   "s"           [98]>
<Equal        "="           [98]>
<Identifier   "impl_stream" [98]>
<LeftParen    "("           [98]>
<Amp          "&"           [98]>
<Identifier   "fibs"        [98]>
<RightParen   ")"           [98]>
<Semicolon    ";"           [98]>
<Var          "let"         [100]>
<Identifier   "ret"         [100]>
<Equal        "="           [100]>
<Number       "0"           [100]>
<Semicolon    ";"           [100]>
<For          "for"         [102]>
<LeftParen    "("           [102]>
<Var          "var"         [102]>
<Identifier   "i"           [102]>
<Equal        "="           [102]>
<Number       "0"           [102]>
<Semicolon    ";"           [102]>
<Identifier   "i"           [102]>
<Less         "<"           [102]>
<Number       "30"          [102]>
<Semicolon    ";"           [102]>
<Identifier   "i"           [102]>
<Equal        "="           [102]>
<Identifier   "i"           [102]>
<Plus         "+"           [102]>
<Number       "1"           [102]>
<RightParen   ")"           [102]>
<LeftBrace    "{"           [102]>
<Var          "let"         [103]>
<Identifier   "n"           [103]>
<Equal        "="           [103]>
<Identifier   "next"        [103]>
<LeftParen    "("           [103]>
<Amp          "&"           [103]>
<Identifier   "s"           [103]>
<RightParen   ")"           [103]>
<Semicolon    ";"           [103]>
<Identifier   "ret"         [104]>
<Equal        "="           [104]>
<Identifier   "ret"         [104]>
<Plus         "+"           [104]>
<Identifier   "n"           [104]>
<Semicolon    ";"           [104]>
<RightBrace   "}"           [105]>
<Identifier   "add0"        [107]>
<Dot          "."           [107]>
<Identifier   "destroy"     [107]>
<LeftParen    "("           [107]>
<RightParen   ")"           [107]>
<Semicolon    ";"           [107]>
<Return       "return"      [109]>
<Identifier   "ret"         [109]>
<Semicolon    ";"           [109]>
<RightBrace   "}"           [110]>
<Eof          ""            [110]>
